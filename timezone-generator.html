<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timezone Table Generator (dark)</title>
<style>
  :root{
    --bg:#0b0f14;          /* page background */
    --panel:#0f1720;       /* card background */
    --muted:#9aa4b2;       /* secondary text */
    --text:#e6eef6;        /* main text */
    --accent:#4ea1ff;      /* buttons / accents */
    --card-border: rgba(255,255,255,0.04);
    --muted-2:#6f7b86;
  }

  html,body{height:100%}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:20px;background:var(--bg);color:var(--text)}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;align-items:center;gap:12px;margin-bottom:10px}
  h1{font-size:20px;margin:0}
  .card{background:var(--panel);padding:16px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.6);margin-bottom:16px;border:1px solid var(--card-border)}
  label{display:block;margin:8px 0 6px;font-size:13px;color:var(--muted)}
  input,select,textarea,button{font:inherit;padding:8px;border:1px solid rgba(255,255,255,0.03);border-radius:8px;background:transparent;color:var(--text)}
  input::placeholder, textarea::placeholder{color:var(--muted-2)}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .row > *{flex:1 1 180px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px;border:1px solid rgba(255,255,255,0.04);text-align:left;font-size:13px}
  th{background:rgba(255,255,255,0.02);color:var(--muted)}
  .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  button{cursor:pointer;background:var(--accent);color:#012239;border:none;padding:10px 12px;border-radius:8px}
  button.secondary{background:transparent;border:1px solid rgba(78,161,255,0.18);color:var(--accent)}
  .small{font-size:12px;color:var(--muted)}
  .zones-edit{width:100%;min-height:90px;white-space:pre-wrap;border:1px solid rgba(255,255,255,0.03)}
  .copy-success{color:#7de28b;margin-left:8px}
  .toggles{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
  .preset-list{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .preset-list button{padding:6px 8px;background:transparent;border:1px solid rgba(255,255,255,0.02);color:var(--accent);border-radius:6px}
  .abbrev-row{display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap}
  .note{font-size:12px;color:var(--muted);margin-top:8px}
  footer{font-size:12px;color:var(--muted);margin-top:12px}
  textarea#raw{background:#071019;border:1px solid rgba(255,255,255,0.03);color:var(--text)}
  @media (max-width:700px){ .row{flex-direction:column} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Timezone Table Generator</h1>
        <div class="small">Enter a source time, pick a timezone or abbreviation (PST/EST/etc.), choose columns & presets, then generate a copy-ready HTML table.</div>
      </div>
    </header>

    <div class="card">
      <label for="datetime">Date &amp; time (wall-clock in source timezone)</label>
      <div class="row">
        <input id="datetime" type="datetime-local" />
        <select id="sourceTz"></select>
      </div>

      <div class="abbrev-row">
        <label style="margin:0;color:var(--muted)">Abbrev / quick pick</label>
        <select id="abbrevSelect" style="width:220px;background:transparent;color:var(--text)">
          <option value="">— pick abbreviation —</option>
        </select>
        <input id="abbrevInput" placeholder="Type e.g. PST or EST" style="max-width:160px" />
        <button id="useAbbrev" class="secondary">Use abbrev</button>
        <div id="abbrevMsg" class="small" style="margin-left:6px;color:#f7c6c6"></div>
      </div>
      <div class="note">Abbreviations can be ambiguous — I map them to the most-likely IANA zone for news scheduling. Tell me if you want a different mapping.</div>

      <label>Pick a preset (or edit the list below)</label>
      <div class="preset-list" id="presets"></div>

      <label for="zones">Target locations (friendly label | IANA zone) — one per line</label>
      <textarea id="zones" class="zones-edit" placeholder="London (UK) | Europe/London
New York (US) | America/New_York
Los Angeles (US) | America/Los_Angeles"></textarea>

      <div class="toggles">
        <label><input type="checkbox" id="colAbbrev" checked /> <span style="color:var(--muted)">Include abbrev</span></label>
        <label><input type="checkbox" id="colOffset" checked /> <span style="color:var(--muted)">Include UTC offset</span></label>
        <label><input type="checkbox" id="colIso" checked /> <span style="color:var(--muted)">Include ISO (with seconds)</span></label>
      </div>

      <div class="controls">
        <button id="generate">Generate HTML Table</button>
        <button id="copy" class="secondary">Copy HTML</button>
        <button id="download" class="secondary">Download .html</button>
        <div id="copied" class="copy-success" style="display:none">Copied ✓</div>
      </div>

      <div id="resultArea" style="margin-top:14px"></div>
    </div>

    <footer>Want friendly labels changed or more presets added? Tell me which cities and I’ll add them.</footer>
  </div>

<script>
/* Abbrev helper + presets. Dark theme only; removed any hosting / overwrite card text. */

const ABBREV_MAP = {
  "PST": "America/Los_Angeles", "PDT": "America/Los_Angeles",
  "MST": "America/Denver", "MDT": "America/Denver",
  "CST": "America/Chicago", "CDT": "America/Chicago",
  "EST": "America/New_York", "EDT": "America/New_York",
  "GMT": "Etc/GMT", "BST": "Europe/London",
  "CET": "Europe/Berlin", "CEST": "Europe/Berlin",
  "IST": "Asia/Kolkata",
  "JST": "Asia/Tokyo", "KST": "Asia/Seoul",
  "AEST": "Australia/Sydney", "AEDT": "Australia/Sydney",
  "UTC": "UTC"
};

const PRESETS = {
  "Common (News)": [
    "Los Angeles (US) | America/Los_Angeles",
    "Chicago (US) | America/Chicago",
    "New York (US) | America/New_York",
    "São Paulo (BR) | America/Sao_Paulo",
    "London (UK) | Europe/London",
    "Paris (FR) | Europe/Paris",
    "Berlin (DE) | Europe/Berlin",
    "Mumbai (IN) | Asia/Kolkata",
    "Tokyo (JP) | Asia/Tokyo",
    "Sydney (AU) | Australia/Sydney",
    "Auckland (NZ) | Pacific/Auckland"
  ],
  "Tech (US-centric)": [
    "San Francisco (US) | America/Los_Angeles",
    "Seattle (US) | America/Los_Angeles",
    "Denver (US) | America/Denver",
    "Austin (US) | America/Chicago",
    "New York (US) | America/New_York",
    "London (UK) | Europe/London",
    "Bangalore (IN) | Asia/Kolkata",
    "Tokyo (JP) | Asia/Tokyo"
  ],
  "All major": [
    "Los Angeles (US) | America/Los_Angeles",
    "Denver (US) | America/Denver",
    "Chicago (US) | America/Chicago",
    "New York (US) | America/New_York",
    "São Paulo (BR) | America/Sao_Paulo",
    "London (UK) | Europe/London",
    "Paris (FR) | Europe/Paris",
    "Berlin (DE) | Europe/Berlin",
    "Moscow (RU) | Europe/Moscow",
    "Mumbai (IN) | Asia/Kolkata",
    "Shanghai (CN) | Asia/Shanghai",
    "Tokyo (JP) | Asia/Tokyo",
    "Sydney (AU) | Australia/Sydney",
    "Auckland (NZ) | Pacific/Auckland"
  ]
};

const tzSelect = document.getElementById('sourceTz');
const dtInput = document.getElementById('datetime');
const zonesTextarea = document.getElementById('zones');
const generateBtn = document.getElementById('generate');
const resultArea = document.getElementById('resultArea');
const copyBtn = document.getElementById('copy');
const copiedEl = document.getElementById('copied');
const downloadBtn = document.getElementById('download');
const colAbbrev = document.getElementById('colAbbrev');
const colOffset = document.getElementById('colOffset');
const colIso = document.getElementById('colIso');
const presetsDiv = document.getElementById('presets');

const abbrevSelect = document.getElementById('abbrevSelect');
const abbrevInput = document.getElementById('abbrevInput');
const useAbbrevBtn = document.getElementById('useAbbrev');
const abbrevMsg = document.getElementById('abbrevMsg');

const popularZones = [
  "UTC","America/Los_Angeles","America/Denver","America/Chicago","America/New_York",
  "America/Sao_Paulo","Europe/London","Europe/Paris","Europe/Berlin","Europe/Moscow",
  "Asia/Kolkata","Asia/Shanghai","Asia/Tokyo","Australia/Sydney","Pacific/Auckland"
];

function populateSourceZones(){
  popularZones.forEach(tz=>{
    const opt = document.createElement('option'); opt.value = tz; opt.textContent = tz; tzSelect.appendChild(opt);
  });
  try{
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    if(tz && !Array.from(tzSelect.options).some(o=>o.value===tz)){
      const o = document.createElement('option'); o.value=tz; o.textContent=tz; tzSelect.insertBefore(o,tzSelect.firstChild);
    }
    tzSelect.value = Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC';
  }catch(e){}
}

function buildPresets(){
  for(const k of Object.keys(PRESETS)){
    const btn = document.createElement('button');
    btn.type='button'; btn.textContent=k;
    btn.addEventListener('click', ()=>{ zonesTextarea.value = PRESETS[k].join('\n'); });
    presetsDiv.appendChild(btn);
  }
}

function buildAbbrevOptions(){
  const keys = Object.keys(ABBREV_MAP);
  keys.sort();
  for(const k of keys){
    const opt = document.createElement('option');
    opt.value = k;
    opt.textContent = `${k} → ${ABBREV_MAP[k]}`;
    abbrevSelect.appendChild(opt);
  }
}

function formatForZone(date, tz, opts){ try { return new Intl.DateTimeFormat(undefined, Object.assign({timeZone: tz}, opts)).format(date);}catch(e){return '—';}}
function tzAbbrev(date, tz){ try { const parts = new Intl.DateTimeFormat('en-US',{timeZone:tz,timeZoneName:'short'}).formatToParts(date); const tzPart = parts.find(p=>p.type==='timeZoneName'); return tzPart?tzPart.value:'';}catch(e){return ''}}
function utcOffsetString(date, tz){
  try{
    const dtF = new Intl.DateTimeFormat('en-US',{timeZone:tz, hour12:false, year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const parts = dtF.formatToParts(date);
    const y = parts.find(p=>p.type==='year').value;
    const mo = parts.find(p=>p.type==='month').value;
    const d = parts.find(p=>p.type==='day').value;
    const hr = parts.find(p=>p.type==='hour').value;
    const min = parts.find(p=>p.type==='minute').value;
    const sec = parts.find(p=>p.type==='second').value;
    const asUtc = Date.UTC(+y, +mo-1, +d, +hr, +min, +sec);
    const diffMinutes = Math.round((asUtc - date.getTime())/60000);
    const offsetMinutes = -diffMinutes;
    const sign = offsetMinutes >= 0 ? '+' : '-';
    const absMin = Math.abs(offsetMinutes);
    const hh = String(Math.floor(absMin/60)).padStart(2,'0');
    const mm = String(absMin%60).padStart(2,'0');
    return `UTC${sign}${hh}:${mm}`;
  }catch(e){ return ''; }
}

function parseLines(text){
  return text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean).map(l=>{
    const parts = l.split('|').map(s=>s.trim());
    if(parts.length===1) return {label:parts[0], tz:parts[0]};
    return {label:parts[0], tz:parts[1]};
  });
}

function parseDateTimeLocalToDate(value, sourceTz){
  const [datePart, timePart] = value.split('T');
  if(!datePart || !timePart) return null;
  const [year,month,day] = datePart.split('-').
